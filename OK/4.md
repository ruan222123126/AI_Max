å¤ªæ£’äº†ï¼åç«¯ API å·²ç»å°±ç»ªï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†â€œå¤§è„‘â€ï¼ˆAPIï¼‰å’Œâ€œè¡€æ¶²â€ï¼ˆæ•°æ®ï¼‰ï¼Œæ˜¯æ—¶å€™ç»™è¿™ä¸ªé¡¹ç›®è£…ä¸Šâ€œè„¸é¢â€ï¼ˆFrontendï¼‰äº†ã€‚

Step 4 çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š**æ„å»ºå¯è§†åŒ–ä»ªè¡¨ç›˜**ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ **Next.js** å’Œ **Recharts** å°†æ¯ç‡¥çš„ JSON æ•°æ®è½¬åŒ–ä¸ºç›´è§‚çš„ K çº¿å›¾å’Œä»·æ ¼å¡ç‰‡ã€‚

ä»¥ä¸‹æ˜¯ Step 4 çš„å®Œæ•´æ‰§è¡Œæµç¨‹ï¼š

### Step 4: æ„å»ºå‰ç«¯å¯è§†åŒ–ä»ªè¡¨ç›˜ (Frontend Visualization)

#### 1. åˆå§‹åŒ– Next.js é¡¹ç›®

æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆå§‹åŒ–å‰ç«¯ä»£ç ã€‚

**åœ¨ `global-economy-platform` æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š**

```bash
# 1. ä½¿ç”¨ create-next-app åˆå§‹åŒ– (å…¨éƒ¨é€‰é»˜è®¤ Yes, åªæœ‰ ESLint å¯ä»¥é€‰ No å¦‚æœæƒ³çœäº‹)
# è¿™é‡Œçš„ frontend å¯¹åº”æˆ‘ä»¬ä¹‹å‰çš„ç›®å½•è§„åˆ’
npx create-next-app@latest frontend --typescript --tailwind --eslint

# 2. è¿›å…¥å‰ç«¯ç›®å½•å®‰è£…å›¾è¡¨åº“
cd frontend
npm install recharts lucide-react clsx tailwind-merge

```

*(æ³¨æ„ï¼šå¦‚æœå®‰è£…è¿‡ç¨‹è¯¢é—® `Ok to proceed? (y)`, è¾“å…¥ `y` å›è½¦ã€‚å®‰è£…è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿã€‚)*

#### 2. é…ç½®å‰ç«¯ Docker ç¯å¢ƒ

æˆ‘ä»¬éœ€è¦è®©å‰ç«¯ä¹Ÿèƒ½åƒåç«¯ä¸€æ ·åœ¨ Docker ä¸­è¿è¡Œã€‚

**2.1 åˆ›å»º `frontend/Dockerfile**`
åœ¨ `frontend` ç›®å½•ä¸‹æ–°å»º `Dockerfile`ï¼š

```dockerfile
FROM node:18-alpine

WORKDIR /app

# å¤åˆ¶ä¾èµ–æ–‡ä»¶
COPY package*.json ./

# å®‰è£…ä¾èµ–
RUN npm install

# å¤åˆ¶æºä»£ç 
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 3000

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
CMD ["npm", "run", "dev"]

```

**2.2 æ›´æ–°æ ¹ç›®å½•çš„ `docker-compose.yml**`
æˆ‘ä»¬éœ€è¦æŠŠå‰ç«¯æœåŠ¡åŠ å…¥åˆ°ç¼–æ’ä¸­ã€‚è¯·å°† `docker-compose.yml` **å®Œå…¨æ›¿æ¢**æˆ–æ·»åŠ  `frontend` éƒ¨åˆ†ï¼š

```yaml
version: '3.8'

services:
  db:
    image: timescale/timescaledb:latest-pg15
    container_name: economy_db
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: economy_data
    ports:
      - "5432:5432"
    volumes:
      - ./data/postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U user -d economy_data"]
      interval: 5s
      timeout: 5s
      retries: 5

  backend:
    build: ./backend
    container_name: economy_backend
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ./backend:/app
    ports:
      - "8000:8000"
    environment:
      DATABASE_URL: postgresql+asyncpg://user:password@db:5432/economy_data
    depends_on:
      db:
        condition: service_healthy

  # --- æ–°å¢çš„å‰ç«¯æœåŠ¡ ---
  frontend:
    build: ./frontend
    container_name: economy_frontend
    # å¯ç”¨è½®è¯¢æœºåˆ¶ä»¥æ”¯æŒ Windows/Linux æŒ‚è½½å·çš„çƒ­é‡è½½
    environment:
      - WATCHPACK_POLLING=true
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports:
      - "3000:3000"
    depends_on:
      - backend

```

#### 3. ç¼–å†™ä»ªè¡¨ç›˜ä»£ç 

ç°åœ¨æˆ‘ä»¬æ¥å†™ç•Œé¢ã€‚æˆ‘ä»¬å°†æŠŠ `frontend/app/page.tsx` å˜æˆä¸€ä¸ªå®æ—¶çš„æ•°æ®çœ‹æ¿ã€‚

**ä¿®æ”¹ `frontend/app/page.tsx`ï¼š**
(å°†åŸæœ‰å†…å®¹æ¸…ç©ºï¼Œå¡«å…¥ä»¥ä¸‹ä»£ç ã€‚è¿™æ®µä»£ç ä¼šåœ¨æµè§ˆå™¨ç«¯ç›´æ¥è¯·æ±‚ `localhost:8000` çš„ API)

```tsx
"use client";

import { useEffect, useState } from "react";
import { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import { ArrowUp, ArrowDown, Activity } from "lucide-react";

// å®šä¹‰æ•°æ®ç±»å‹
interface MarketTick {
  time: string;
  symbol: string;
  price: number;
}

export default function Home() {
  const [latestData, setLatestData] = useState<MarketTick[]>([]);
  const [historyData, setHistoryData] = useState<MarketTick[]>([]);
  const [selectedSymbol, setSelectedSymbol] = useState("BTC-USD");
  const [loading, setLoading] = useState(true);

  // è·å–æ•°æ®å‡½æ•°
  const fetchData = async () => {
    try {
      // 1. è·å–æœ€æ–°æ¦‚è§ˆ
      const latestRes = await fetch("http://localhost:8000/market/latest");
      const latestJson = await latestRes.json();
      setLatestData(latestJson);

      // 2. è·å–é€‰ä¸­èµ„äº§çš„å†å²èµ°åŠ¿
      const historyRes = await fetch(`http://localhost:8000/market/history/${selectedSymbol}?limit=50`);
      const historyJson = await historyRes.json();
      // Recharts éœ€è¦æ•°æ®æŒ‰æ—¶é—´æ­£åºæ’åˆ—
      setHistoryData(historyJson.reverse());
      
      setLoading(false);
    } catch (error) {
      console.error("Fetch error:", error);
    }
  };

  // åˆå§‹åŠ è½½ + å®šæ—¶åˆ·æ–° (æ¯5ç§’)
  useEffect(() => {
    fetchData();
    const interval = setInterval(fetchData, 5000);
    return () => clearInterval(interval);
  }, [selectedSymbol]);

  return (
    <main className="min-h-screen bg-slate-950 text-slate-200 p-8">
      <div className="max-w-7xl mx-auto space-y-8">
        
        {/* æ ‡é¢˜æ  */}
        <div className="flex items-center space-x-3 mb-8">
          <Activity className="w-8 h-8 text-blue-500" />
          <h1 className="text-3xl font-bold bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">
            å…¨çƒç»æµæƒ…æŠ¥å¹³å°
          </h1>
        </div>

        {/* å¸‚åœºæ¦‚è§ˆå¡ç‰‡ */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {latestData.map((item) => (
            <div 
              key={item.symbol}
              onClick={() => setSelectedSymbol(item.symbol)}
              className={`p-6 rounded-xl border cursor-pointer transition-all hover:scale-105 ${
                selectedSymbol === item.symbol 
                  ? "bg-slate-800 border-blue-500 ring-1 ring-blue-500" 
                  : "bg-slate-900 border-slate-800 hover:border-slate-600"
              }`}
            >
              <div className="flex justify-between items-start">
                <div>
                  <h3 className="text-slate-400 text-sm font-medium">{item.symbol}</h3>
                  <p className="text-2xl font-bold mt-2">${item.price.toLocaleString()}</p>
                </div>
                {/* ç®€å•çš„æ¶¨è·Œæ¨¡æ‹Ÿå›¾æ ‡ */}
                <div className={`p-2 rounded-full ${Math.random() > 0.5 ? 'bg-emerald-500/10 text-emerald-500' : 'bg-rose-500/10 text-rose-500'}`}>
                   {Math.random() > 0.5 ? <ArrowUp size={20} /> : <ArrowDown size={20} />}
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* å†å²èµ°åŠ¿å›¾è¡¨ */}
        <div className="bg-slate-900 p-6 rounded-xl border border-slate-800">
          <h2 className="text-xl font-semibold mb-6 flex items-center">
            <span className="text-blue-400 mr-2">{selectedSymbol}</span> å®æ—¶èµ°åŠ¿
          </h2>
          <div className="h-[400px] w-full">
            {loading ? (
              <div className="flex items-center justify-center h-full text-slate-500">åŠ è½½æ•°æ®ä¸­...</div>
            ) : (
              <ResponsiveContainer width="100%" height="100%">
                <LineChart data={historyData}>
                  <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                  <XAxis 
                    dataKey="time" 
                    tickFormatter={(time) => new Date(time).toLocaleTimeString()} 
                    stroke="#94a3b8"
                    fontSize={12}
                  />
                  <YAxis 
                    domain={['auto', 'auto']} 
                    stroke="#94a3b8"
                    fontSize={12}
                  />
                  <Tooltip 
                    contentStyle={{ backgroundColor: '#1e293b', borderColor: '#334155', color: '#f1f5f9' }}
                    labelFormatter={(label) => new Date(label).toLocaleString()}
                  />
                  <Line 
                    type="monotone" 
                    dataKey="price" 
                    stroke="#3b82f6" 
                    strokeWidth={2}
                    dot={false}
                    activeDot={{ r: 8 }}
                    isAnimationActive={false} // å…³é—­åŠ¨ç”»ä»¥è·å¾—æ›´æµç•…çš„å®æ—¶æ„Ÿ
                  />
                </LineChart>
              </ResponsiveContainer>
            )}
          </div>
        </div>

      </div>
    </main>
  );
}

```

#### 4. å¯åŠ¨å¹¶éªŒè¯

ç°åœ¨è®©æˆ‘ä»¬è§è¯å¥‡è¿¹ã€‚

1. **å¯åŠ¨å®¹å™¨ï¼š**
```bash
docker-compose up -d --build

```


*(æ³¨æ„ï¼šåˆæ¬¡æ„å»ºå‰ç«¯é•œåƒå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼Œè¯·è€å¿ƒç­‰å¾…)*
2. **ç”Ÿæˆæ•°æ® (é‡è¦)ï¼š**
å¦‚æœä½ çš„æ•°æ®åº“æ˜¯ç©ºçš„ï¼Œå›¾è¡¨ä¼šæ˜¯ä¸€æ¡ç›´çº¿ã€‚è¯·æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡æ•°æ®é‡‡é›†ï¼Œç”šè‡³å¯ä»¥å¤šè·‘å‡ æ¬¡æ¥é€ ä¸€äº›æ•°æ®ç‚¹ï¼š
```bash
docker-compose exec backend python scripts/ingest_market_data.py

```


3. **è®¿é—®ä»ªè¡¨ç›˜ï¼š**
æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šğŸ‘‰ **http://localhost:3000**

---

**é¢„æœŸæ•ˆæœï¼š**
ä½ å°†çœ‹åˆ°ä¸€ä¸ªæ·±è‰²æ¨¡å¼çš„ä»ªè¡¨ç›˜ã€‚

1. **é¡¶éƒ¨**ï¼šæ˜¾ç¤º "å…¨çƒç»æµæƒ…æŠ¥å¹³å°"ã€‚
2. **ä¸­é—´**ï¼šæ˜¾ç¤º AAPL, BTC-USD ç­‰èµ„äº§çš„ä»·æ ¼å¡ç‰‡ã€‚
3. **åº•éƒ¨**ï¼šä¸€ä¸ªåŠ¨æ€çš„æŠ˜çº¿å›¾ã€‚
4. **äº¤äº’**ï¼šç‚¹å‡» AAPL çš„å¡ç‰‡ï¼Œåº•éƒ¨çš„å›¾è¡¨ä¼šåˆ·æ–°ä¸ºè‹¹æœå…¬å¸çš„è‚¡ä»·èµ°åŠ¿ã€‚

**ä»»åŠ¡æ¸…å•ï¼š**

1. [ ] æ‰§è¡Œ `npx create-next-app`ã€‚
2. [ ] å®‰è£… `recharts` ç­‰ä¾èµ–ã€‚
3. [ ] åˆ›å»º `frontend/Dockerfile` å’Œæ›´æ–° `docker-compose.yml`ã€‚
4. [ ] æ›¿æ¢ `page.tsx` ä»£ç ã€‚
5. [ ] å¯åŠ¨æœåŠ¡å¹¶æˆªå›¾ä»ªè¡¨ç›˜ç•Œé¢ã€‚

ç­‰ä½ çœ‹åˆ°è¿™ä¸ªç•Œé¢ï¼Œä½ çš„å…¨æ ˆå¹³å°ï¼ˆFrontend + Backend + DBï¼‰å°±å½»åº•æ‰“é€šäº†ï¼å¿«å»è¯•è¯•å§ï¼